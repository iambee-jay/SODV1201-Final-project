<!-- account.html -->
<!DOCTYPE html>
<html>
  <head>
    <title>My Account</title>
  </head>
  <body>
    <h1>My Account</h1>
    <div id="username"></div>
    <h2>My Courses</h2>
    <ul id="courseList"></ul>
    <script>
      // Check if ID is in session storage
      const id = localStorage.getItem("userId");
      if (!id) {
        // Redirect to Home if no ID in session storage
        window.location.href = "index.html";
      } else {
        // Request account data from /account/:id
        fetch(`/account/${id}`)
          .then((response) => response.json())
          .then((data) => {
            // Display username
            let user = data.user;
            document.getElementById(
              "username"
            ).textContent = `Username: ${user.username}`;

            // Display course list
            const courseList = document.getElementById("courseList");
            user.courses.forEach((course) => {
              // Create course list item
              const li = document.createElement("li");
              li.textContent = `${course.code} ${course.num}: ${course.title} - ${course.description}`;

              // Create remove button
              const removeButton = document.createElement("button");
              removeButton.textContent = "Remove";
              removeButton.addEventListener("click", () => {
                // Send patch request to /account/:id/courses/remove with course object
                fetch(`/account/${id}/courses/remove`, {
                  method: "PATCH",
                  headers: {
                    "Content-Type": "application/json",
                  },
                  body: JSON.stringify(course),
                })
                  .then(() => {
                    // Refresh list UI with updated list
                    li.remove();
                  })
                  .catch((error) => console.error(error));
              });

              // Add remove button to course list item
              li.appendChild(removeButton);

              // Add course list item to course list
              courseList.appendChild(li);
            });
          })
          .catch((error) => console.error(error));
      }
    </script>
  </body>
</html>
